<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
 
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"> 
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
        <title>carcassonne</title>
        <script type="text/javascript" src="mootools-1.2.4-core.js"></script>
        <script type="text/javascript" src="mootools-1.2.4.4-more.js"></script>
        <script type="text/javascript" src="res.js"></script>
        <script type="text/javascript" src="carcassonne.js"></script>
        <script type="text/javascript">
            var board;
            var tile;

            Element.Events.spacePressed = {
                base: 'keypress',
                condition: function(ev) {
                    return ev.key == 'space' && !ev.alt && !ev.control && !ev.shift;
                }
            };

            window.addEvent('domready', function() {
                board = new Board('B0');
                $(board).inject($("cont"));

                $("width").set("text", window.getSize().x);
                $("height").set("text", window.getSize().y);

                $("stop").addEvent('click', function() {
                    if (!tile)
                        return;
                    tile.freeze();
                    $(board).makeDraggable({handle: tile});
                });

                window.addEvent('click', function(ev) {
                    var coord = board.getGridCoord(ev.page);
                    coord['val'] = board.getNeighborCnt(coord);
                    $("neighbor").set("text", "{gX} {gY} {val}".substitute(coord));

                    if (board.occupied(coord))
                        return;

                    // handle the last tile
                    if (tile) {
                        tile.moveTo(coord);
                        return;
                    }
                });

                var createdCnt = 0;
                window.addEvent('dblclick', function(ev) {
                    var c = board.getGridCoord(ev.page);
                    if (board.occupied(c))
                        return;
                    
                    // add new one
                    tile = board.createTile(createdCnt++, Math.floor(Math.random()*24), c);
                    tile.makeDraggable();
                    tile.addEvent('terraclick', function(t, terra, terraType, ev) {
                        var pos = $(t).getPosition();
                        $("x").set("text", ev.page.x - pos.x);
                        $("y").set("text", ev.page.y - pos.y);
                        $("target").set("text", terraType + ' ' + terra);
                    });

                });

                window.addEvent("spacePressed", function() {
                    if (tile)
                        tile.rotate();
                    return false;
                });

            });
        </script>
    <link rel="stylesheet" type="text/css" href="carcassonne.css" />
    <script type="text/javascript">
        var playerNum = null;
        window.addEvent("domready", function() {
            //$("scoreBoardPanel").makeDraggable();
            $each($$('.scoreBoard'), function(b) {
                b.addEvent('click', function() {
                    if (playerNum) {
                        $('player' + playerNum).set('text', '');
                        $('scoreBoard' + playerNum).removeClass('scoreBoardChosen');
                    }
                    playerNum = this.getProperty('player');
                    $('player' + playerNum).set('text', 'jayven');
                    $('scoreBoard' + playerNum).addClass('scoreBoardChosen');
                    return false;
                });
            });
        });
    </script>
    </head>
    <body>
        <div style="position:fixed;left:1000px;">
            <div>!!Work only on chrome 4+</div>
            <div>width:<span id="width"></span></div>
            <div>height:<span id="height"></span></div>
            <div>x:<span id="x"></span></div>
            <div>y:<span id="y"></span></div>
            <div>target:<span id="target"></span></div>
            <div>neighbor: <span id="neighbor"></span></div>
            <input type="button" id="stop" name="stop" value="stop" />
        </div>
        <div id="cont" style="position:absolute;left:1000px;top:500px">
        </div>
        <div id="scoreBoardPanel">
            <table class="scoreBoard roundedBox" id="scoreBoard1" player="1">
                <tr><td><div class="meepleBase meeple1 meepleOnBoard" /></td><td id="player1"></td></tr>
                <tr><td class="alignR">meeple: </td><td id="meeple1">7</td></tr>
                <tr><td class="alignR">score: </td><td id="score1">0</td></tr>
                <tr><td class="alignR">ready: </td><td id="ready1">No</td></tr>
            </table>
            <table class="scoreBoard roundedBox" id="scoreBoard2" player="2">
                <tr><td><div class="meepleBase meeple2 meepleOnBoard" /></td><td id="player2"></td></tr>
                <tr><td class="alignR">meeple: </td><td id="meeple2">7</td></tr>
                <tr><td class="alignR">score: </td><td id="score2">0</td></tr>
                <tr><td class="alignR">ready: </td><td id="ready2">No</td></tr>
            </table>
            <table class="scoreBoard roundedBox" id="scoreBoard3" player="3">
                <tr><td><div class="meepleBase meeple3 meepleOnBoard" /></td><td id="player3"></td></tr>
                <tr><td class="alignR">meeple: </td><td id="meeple3">7</td></tr>
                <tr><td class="alignR">score: </td><td id="score3">0</td></tr>
                <tr><td class="alignR">ready: </td><td id="ready3">No</td></tr>
            </table>
            <table class="scoreBoard roundedBox" id="scoreBoard4" player="4">
                <tr><td><div class="meepleBase meeple4 meepleOnBoard" /></td><td id="player4"></td></tr>
                <tr><td class="alignR">meeple: </td><td id="meeple4">7</td></tr>
                <tr><td class="alignR">score: </td><td id="score4">0</td></tr>
                <tr><td class="alignR">ready: </td><td id="ready4">No</td></tr>
            </table>
            <table class="scoreBoard roundedBox" id="scoreBoard5" player="5">
                <tr><td><div class="meepleBase meeple5 meepleOnBoard" /></td><td id="player5"></td></tr>
                <tr><td class="alignR">meeple: </td><td id="meeple5">7</td></tr>
                <tr><td class="alignR">score: </td><td id="score5">0</td></tr>
                <tr><td class="alignR">ready: </td><td id="ready5">No</td></tr>
            </table>
        </div>
        <div id="msgPanel" class="alignC roundedBox">
            <div id="msgHelp" class="roundedBox">请选择您的颜色</div>
            <div id="msgHistory" class="roundedBox"></div>
            <form>
            <input class="roundedBox" size="30" type="text" id="msg" name="msg" />
            <input class="roundedBox floatR" type="submit" value="send" />
            </form>
        </div>
    </body>
</html>
